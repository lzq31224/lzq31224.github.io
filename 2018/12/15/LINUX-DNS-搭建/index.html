<html>
  <head><meta name="generator" content="Hexo 3.8.0">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  
    <link rel="icon" href="/images/favicon.ico">
  
  <title>Hexo</title>
  <link rel="stylesheet" href="/css/styles.css">
  <script src="/lib/jquery.js"></script>
  <link rel="stylesheet" href="/lib/bootstrap/css/bootstrap.min.css">
  <script src="/js/common.js"></script>
  <script src="/lib/bootstrap/js/bootstrap.js"></script>
  <link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
</head>

  <body>
    <header class="header">
  <div class="color-bar">
    <ul>
      <li class="bar1"></li>
      <li class="bar2"></li>
      <li class="bar3"></li>
      <li class="bar4"></li>
      <li class="bar5"></li>
      <li class="bar6"></li>
    </ul>
  </div>
  <div class="header-wrapper">
    <div class="blog-title">
      
        <img class="logo" src="/images/logo.png" alt="logo">
      
      <a href="/" class="title">Hexo</a>
    </div>
    <nav class="navbar navbar-menu">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" id="nav-btn" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
        </div>
      </div>
        <ul class="menu menu-pc">
          
            <li class="menu-item">
              <a href="/" class="menu-item-link"><i class="fa fa-home"></i><span>首页</span></a>
            </li>
          
            <li class="menu-item">
              <a href="/tags/" class="menu-item-link"><i class="fa fa-tags"></i><span>Tags</span></a>
            </li>
          
            <li class="menu-item">
              <a href="/archives/" class="menu-item-link"><i class="fa fa-file"></i><span>归档</span></a>
            </li>
          
            <li class="menu-item">
              <a href="https://github.com/littleee/" class="menu-item-link"><i class="fa fa-github"></i><span>github</span></a>
            </li>
          
        </ul>
    </nav>
  </div>
</header>
<div class="collapse nav-collapse" style="position:fixed;top:59px;" id="bs-example-navbar-collapse-1">
  <ul class="menu menu-mobile" style="list-style:none">
    
      <li class="menu-item">
        <a href="/" class="menu-item-link"><i class="fa fa-home"></i><span>首页</span></a>
      </li>
    
      <li class="menu-item">
        <a href="/tags/" class="menu-item-link"><i class="fa fa-tags"></i><span>Tags</span></a>
      </li>
    
      <li class="menu-item">
        <a href="/archives/" class="menu-item-link"><i class="fa fa-file"></i><span>归档</span></a>
      </li>
    
      <li class="menu-item">
        <a href="https://github.com/littleee/" class="menu-item-link"><i class="fa fa-github"></i><span>github</span></a>
      </li>
    
  </ul>
</div>

    <main class="main">
      <div class="content">
        
  <article class="post">
    <div class="post-title">
      <h2 class="title">LINUX DNS 搭建</h2>
       
        <p>LINUX</p>
      
    </div>
     <div class="post-meta">
      <span class="post-time">2018-12-15</span>
    </div>
    <div class="post-content">
      <p></p><h2>DNS相关信息</h2><p></p>
<p></p><h3>1. 什么是DNS</h3><p></p>
<blockquote>
<p>DNS（Domain Name System，域名系统），万维网上作为域名和IP地址相互映射的一个分布式数据库，能够使用户更方便的访问互联网，而不用去记住能够被机器直接读取的IP数串。通过域名，最终得到该域名对应的IP地址的过程叫做域名解析（或主机名解析）。</p>
</blockquote>
<p></p><h3>2. DNS的功能</h3><p></p>
<blockquote>
<p>每个IP地址都可以有一个主机名，主机名由一个或多个字符串组成，字符串之间用小数点隔开。有了主机名，就不要死记硬背每台IP设备的IP地址，只要记住相对直观有意义的主机名就行了。这就是DNS协议的功能。<br>主机名到IP地址的映射有两种方式：<br></p>
<blockquote>
<p>1）静态映射，每台设备上都配置主机到IP地址的映射，各设备独立维护自己的映射表，而且只供本设备使用；<br><br>2）动态映射，建立一套域名解析系统（DNS），只在专门的DNS服务器上配置主机到IP地址的映射，网络上需要使用主机名通信的设备，首先需要到DNS服务器查询主机所对应的IP地址。</p>
</blockquote>
</blockquote>
<hr>
<p></p><h2>如何在centos7上安装DNS</h2><p></p>
<p></p><h3>1.了解centos7上所用的bind</h3><p></p>
<blockquote>
<p>BIND(Berkeley Internet Name Domain)BIND（Berkeley Internet Name Daemon）是现今互联网上最常使用的DNS服务器软件，使用BIND作为服务器软件的DNS服务器约占所有DNS服务器的九成。BIND现在由互联网系统协会（Internet Systems Consortium）负责开发与维护。</p>
</blockquote>
<p></p><h3>2.准备环境</h3><p></p>
<blockquote>
<p>vmware15 (用来安装虚拟机)<br><br>centos7一台（服务器）<br><br>ip = 192.168.5.135 （在终端输入’ifconfig’可查看ip）<br></p>
</blockquote>
<p></p><h3>3.开始安装</h3><br>首先打开终端（右键桌面有打开终端选项）<br><br>查看所有可以安装的bind软件<br> <h3>1. 用yum安装 </h3><br> <code># yum list bind*</code>(*通配符，表示所有)<br>未安装的：<br><p></p>
<blockquote>
<p><img src="http://155.254.48.100/bolgimg/LINUX/linuxDns/yumlist2.png" alt><br>安装之后的：<br><img src="http://155.254.48.100/bolgimg/LINUX/linuxDns/yumlist.png" alt><br><br>如图，我的已经安装好了<br>你们可用 <code># yum install bind bind-libs bind-chroot -y</code> (-y 表示需要确认时选择y)<br><br><img src="http://155.254.48.100/bolgimg/LINUX/linuxDns/yumb.png" alt></p>
</blockquote>
<p></p><h3>2. 也可用rpm 进行安装</h3><br> <code># rpm  -qa|grep bind*</code>(首先先查询一下)<br><br> <h4>DNS服务通常需要安装的RPM软件包如下：</h4><p></p>
<blockquote>
<p>① bind-9.9.4-61.el7.x86_64.rpm<br>该软件包为DNS服务主程序包，服务器必须安装！<br><br>② bind-libs-9.9.4-61.el7.x86_64.rpm<br>该软件包提供实现域名解析功能必备的库文件 <br><br>③ bind-chroot-9.9.4-61.el7.x86_64.rpm<br>该软件包的作用是将运行限制在一个虚拟根目录下，以隐藏运行时的真实目录。<br></p>
</blockquote>
<p></p><h4>将上述主要软件包先复制到系统某个目录（例如root）下 ,然后再通过rpm命令安装到系统中。rpm安装命令(参考)</h4><p></p>
<ul>
<li># rpm  -ivh  bind-9.9.4-61.el7.x86_64.rpm   </li>
<li># rpm  -ivh  bind-libs-9.9.4-61.el7.x86_64.rpm</li>
<li># rpm  -ivh  bind-chroot-9.9.4-61.el7.x86_64.rpm</li>
</ul>
<p></p><h3>安装完成后 Dns 可正常启动，但无法正常运行 需要更改配置文件</h3><p></p>
<blockquote>
<p><img src="http://155.254.48.100/bolgimg/LINUX/linuxDns/1.png" alt></p>
</blockquote>
<hr>
<p></p><h2>4.更改配置文件</h2><p></p>
<p></p><h4>1. 关于主配置文件</h4>   /etc/named.conf<br><br>在修改主配置文件 /etc/named.conf之前，请先作备份：<p></p>
<ul>
<li><strong> # cp /etc/named.conf  /etc/named.conf.bak </strong></li>
<li><strong>$ sudo cp /etc/named.conf  /etc/named.conf.bak</strong></li>
</ul>
<p>Bind的主配置文件是/etc/named.conf，该文件只包括Bind的基本配置，并不包含任何DNS区域数据。<br><br>/etc/named.conf 文件说明：</p>
<ul>
<li>/etc/named.conf文件说明DNS服务器的全局参数，由多个BIND配置命令所组成，每个配置命令后是参数和用大括号括起来的配置子句块，各配置子句也包含相应的参数，并以分号结束，其语法类似于C语言。named.conf文件中最常用的配置语句有两个：options语句和zone语句。<br><h4>参数说明：</h4><blockquote>
<p> options {</p>
<ul>
<li>listen-on port 53 { 127.0.0.1; };// ipv4监听端口和ip地  址，默认只有本地的<br>listen-on-v6 port 53 { ::1; };   // ipv6的监听端口和ip地址<br>directory     “/var/named”;      //定义DNS区域数据文件的读写路径<br>allow-query     { localhost; };  //允许可对本DNS进行查询的客户机<br>recursion yes;   // yes 是允许递归查询,off不允许<br>dnssec-enable yes;        //3条关于DNS安全的设置<br>dnssec-validation yes;   //表示在DNS查询的过程中加密,no 不加密<br>include “/etc/named.rfc1912.zones”; // 把named.rfc1912.zones文件包含进来</li>
</ul>
</blockquote>
</li>
</ul>
<hr>
<p></p><h4>2.接下来，开始更改配置文件</h4><br>首先 运行下面这条代码<br><p></p>
<ul>
<li><code>$ sudo gedit /ect/named.conf</code> 或</li>
<li><code># gedit /ect/named.conf</code><br><br>打开文件后 如下图更改<br></li>
<li>注意 192.168.5.135 为我的主机ip，你们填自己的ip就可以了<br><br><img src="http://155.254.48.100/bolgimg/LINUX/linuxDns/2.png" alt><br>根据自己要求添加<br><blockquote>
<p>DNS配置要求：在本网络能够解析2个域名称：<br></p>
<ul>
<li>lzq.com     ahead.net<br></li>
<li>和一个反向解析 <br></li>
</ul>
</blockquote>
</li>
</ul>
<p><img src="http://155.254.48.100/bolgimg/LINUX/linuxDns/3.png" alt><br> 更改完成后接下来开始创建zone文件<br></p>
<p></p><h4>3.接下来，开始编写zone文件</h4><br>1.在终端输入如下代码，创建并编写文件:<p></p>
<blockquote>
<ul>
<li># gedit /var/named/192.168.5.zone</li>
<li>$ sudo gedit /var/named/192.168.5.zone<br>其他2个自行替换</li>
</ul>
</blockquote>
<p>2.或者直接用图形化进入文件夹，右键创建文件，<br><img src="http://155.254.48.100/bolgimg/LINUX/linuxDns/4.png" alt></p>
<p>考虑到文件内容过大 点击文件名可进行下载</p>
<h3 id="仅供参考-需要自行更改文件名-主机名和ip-网关等"><a href="#仅供参考-需要自行更改文件名-主机名和ip-网关等" class="headerlink" title="仅供参考 需要自行更改文件名 主机名和ip 网关等"></a>仅供参考 需要自行更改文件名 主机名和ip 网关等</h3><blockquote>
<p><a href="http://155.254.48.100/bolgimg/LINUX/linuxDns/192.168.5.zone" target="_blank" rel="noopener">192.168.5.zone</a>(点击下载)文件内容如下</p>
</blockquote>
<p><img src="http://155.254.48.100/bolgimg/LINUX/linuxDns/5.png" alt></p>
<blockquote>
<p><a href="http://155.254.48.100/bolgimg/LINUX/linuxDns/ahead.net.zone" target="_blank" rel="noopener">ahead.net.zone</a>(点击下载)文件内容如下</p>
</blockquote>
<p><img src="http://155.254.48.100/bolgimg/LINUX/linuxDns/6.png" alt></p>
<blockquote>
<p><a href="http://155.254.48.100/bolgimg/LINUX/linuxDns/lzq.com.zone" target="_blank" rel="noopener">lzq.com.zone</a>(点击下载)文件内容如下</p>
</blockquote>
<p><img src="http://155.254.48.100/bolgimg/LINUX/linuxDns/7.png" alt></p>
<ul>
<li>接下来，还需要更改 /etc/resolv.conf<blockquote>
<p># gedit /etc/resolv.conf<br>$ sudo gedit /etc/resolv.conf</p>
</blockquote>
</li>
</ul>
<blockquote>
<ul>
<li>将图中的ip换成你的ip<br><img src="http://155.254.48.100/bolgimg/LINUX/linuxDns/9.png" alt></li>
</ul>
</blockquote>
<h2 id="尝试启动"><a href="#尝试启动" class="headerlink" title="尝试启动"></a>尝试启动</h2><blockquote>
<p>systemctl restart named (无报错则启动成功)<br>nslookup<br>    >lzq.com</p>
</blockquote>
<p><img src="http://155.254.48.100/bolgimg/LINUX/linuxDns/8.png" alt></p>
<p>如果你的和图中解析的一样的话，dns就初步搭好了</p>

    </div>
  </article>
  <div class="post-nav">
    <div class="post-nav-next post-nav-item">
      
    </div>

    <span class="post-nav-divider"></span>

    <div class="post-nav-prev post-nav-item">
    
        <a href="/2018/12/16/LINUX-centos7-vmtools-安装/" rel="prev" title="LINUX centos7 vmtools 安装">
          LINUX centos7 vmtools 安装 <i class="fa fa-chevron-right"></i>
        </a>
      
    </div>
  </div>



      </div>
        <div class="footer">
  <div class="footer-wrapper">
    <div class="copyright">
      
      <span>&copy;</span>
      
      <span>2017 - 2019</span>
      
      <span class="author"><i class="fa fa-user"></i>John Doe</span>
    </div>
    
      <span>Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> </span>
    
    
      <span>|</span> <span>Theme - <a href="https://github.com/littleee/corazon">Corazon</a></span>
      
        <span>v1.0.0</span>
      
    
  </div>
</div>

    </main>
  </body>
</html>
